<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#0a0a0a">
  <meta name="description" data-i18n-content="meta.description" content="DeepMemo - SystÃ¨me de gestion de connaissances basÃ© sur des nÅ“uds rÃ©cursifs, interconnectÃ©s et actifs">
  <meta name="keywords" data-i18n-content="meta.keywords" content="gestion connaissances, prise de notes, PKM, second cerveau, Zettelkasten, notes hiÃ©rarchiques, symlinks, tags, offline-first, privacy-first, PWA">
  <meta name="author" content="DeepMemo Team">
  <title data-i18n="meta.title">DeepMemo V0.9.1</title>

  <!-- Canonical URL -->
  <link rel="canonical" href="https://deepmemo.org/">

  <!-- PWA and Apple Meta Tags -->
  <link rel="icon" type="image/svg+xml" href="favicon.svg">
  <link rel="manifest" id="app-manifest" href="manifest-fr.json">
  <meta name="application-name" content="DeepMemo">
  <meta name="apple-mobile-web-app-title" content="DeepMemo">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <!-- Open Graph (Facebook, LinkedIn) -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://deepmemo.org/">
  <meta property="og:title" data-i18n-content="meta.ogTitle" content="DeepMemo - Your second brain">
  <meta property="og:description" data-i18n-content="meta.description" content="DeepMemo - SystÃ¨me de gestion de connaissances basÃ© sur des nÅ“uds rÃ©cursifs, interconnectÃ©s et actifs">
  <meta property="og:image" content="https://deepmemo.org/icons/og-image.png">
  <meta property="og:locale" content="en_US">
  <meta property="og:locale:alternate" content="fr_FR">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:url" content="https://deepmemo.org/">
  <meta name="twitter:title" data-i18n-content="meta.ogTitle" content="DeepMemo - Your second brain">
  <meta name="twitter:description" data-i18n-content="meta.description" content="DeepMemo - SystÃ¨me de gestion de connaissances basÃ© sur des nÅ“uds rÃ©cursifs, interconnectÃ©s et actifs">
  <meta name="twitter:image" content="https://deepmemo.org/icons/twitter-card.png">

  <!-- Structured Data (JSON-LD) -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "DeepMemo",
    "url": "https://deepmemo.org/",
    "description": "Privacy-first knowledge management system with hierarchical nodes, symlinks, tags, and branch isolation. Works fully offline.",
    "applicationCategory": "ProductivityApplication",
    "operatingSystem": "Any (Web-based)",
    "browserRequirements": "Requires JavaScript. Works with all modern browsers.",
    "offers": {
      "@type": "Offer",
      "price": "0",
      "priceCurrency": "USD"
    },
    "creator": {
      "@type": "Organization",
      "name": "DeepMemo Team"
    },
    "featureList": [
      "Hierarchical knowledge network",
      "Symlinks and tags",
      "Branch isolation mode",
      "File attachments (up to 50MB per file)",
      "Full offline support (PWA)",
      "Privacy-first (local storage only, no server)",
      "Bilingual interface (French/English)",
      "Export/Import (ZIP format)",
      "Multi-tab synchronization",
      "Keyboard shortcuts"
    ],
    "screenshot": "https://deepmemo.org/icons/screenshot.png",
    "softwareVersion": "0.9.1",
    "releaseNotes": "https://deepmemo.org/docs/ROADMAP.md",
    "inLanguage": ["en", "fr"]
  }
  </script>
  <script>
    // Load correct manifest and update lang attribute based on language preference
    (function() {
      const savedLang = localStorage.getItem('deepmemo_language');
      const browserLang = navigator.language.toLowerCase().startsWith('fr') ? 'fr' : 'en';
      const lang = savedLang || browserLang;
      const manifestHref = lang === 'en' ? 'manifest-en.json' : 'manifest-fr.json';

      // Update manifest
      document.getElementById('app-manifest').href = manifestHref;

      // Update HTML lang attribute
      document.documentElement.lang = lang;
    })();
  </script>
  <link rel="stylesheet" href="src/css/style.css">
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
</head>
<body>
  <!-- Mobile warning banner -->
  <div id="mobileWarningBanner" class="mobile-warning-banner" style="display: none;">
    <div class="mobile-warning-content">
      <span class="mobile-warning-icon">ğŸ“±</span>
      <div class="mobile-warning-text">
        <strong data-i18n="mobileWarning.title">Version mobile en dÃ©veloppement</strong>
        <p data-i18n="mobileWarning.message">L'expÃ©rience mobile est en cours d'amÃ©lioration. Pour une utilisation optimale, nous recommandons d'utiliser un ordinateur.</p>
      </div>
      <button class="mobile-warning-close" onclick="app.closeMobileWarning()" data-i18n-title="actions.close" title="Fermer">âœ•</button>
    </div>
  </div>

  <button class="right-panel-toggle-external" onclick="app.toggleRightPanel()">â„¹ï¸</button>

  <div class="app-container">
    <div class="sidebar">
      <div class="sidebar-header">
        <h1 data-i18n="app.title">ğŸŒŸ DeepMemo</h1>
        <div class="tagline" data-i18n="app.tagline">Ton second cerveau</div>
        <div class="node-counter" id="nodeCounter">0 nÅ“uds</div>
      </div>

      <div class="sidebar-actions">
        <button class="btn" data-i18n="actions.newNode" onclick="app.createRootNode()">â• Nouveau nÅ“ud</button>
        <div class="import-export-zone">
          <input type="file" id="importFile" accept=".json,.zip" onchange="app.importData(event)">
          <label for="importFile" class="btn-import" data-i18n="actions.import">ğŸ“‚ Importer</label>
          <button class="btn-import" data-i18n="actions.export" onclick="app.exportData()">ğŸ’¾ Exporter</button>
        </div>
      </div>

      <div class="tree-container" id="treeContainer"></div>
      <div class="sidebar-resizer" id="sidebarResizer"></div>
    </div>

    <div class="main-content">
      <div id="emptyState" class="empty-state">
        <div class="empty-state-icon" data-i18n="empty.icon">ğŸ§©</div>
        <h2 data-i18n="messages.welcome">Bienvenue dans DeepMemo</h2>
        <p data-i18n="messages.welcomeSubtitle">CrÃ©e ton premier nÅ“ud pour commencer</p>
      </div>

      <div id="editorContainer" style="display: none; flex: 1; display: flex; flex-direction: column;">
        <div class="breadcrumb" id="breadcrumb"></div>

        <div class="content-header">
          <div style="display: flex; align-items: center; gap: 8px;">
            <input type="text" class="content-title-input" id="nodeTitle"
                   data-i18n-placeholder="placeholders.nodeTitle" placeholder="Titre du nÅ“ud" onchange="app.saveCurrentNode()">
            <a href="#" id="shareLink" data-i18n-title="tooltips.shareNode" title="Copier l'URL de ce nÅ“ud (prÃ©serve le contexte actuel)"
               style="font-size: 20px; text-decoration: none; cursor: pointer; opacity: 0.6; transition: opacity 0.2s;"
               onmouseover="this.style.opacity='1'"
               onmouseout="this.style.opacity='0.6'"
               onclick="app.shareNode(event)">ğŸ”—</a>
            <a href="#" id="shareBranchLink" data-i18n-title="tooltips.shareBranch" title="Copier l'URL en mode branche isolÃ©e (vue focus)"
               style="font-size: 20px; text-decoration: none; cursor: pointer; opacity: 0.6; transition: opacity 0.2s;"
               onmouseover="this.style.opacity='1'"
               onmouseout="this.style.opacity='0.6'"
               onclick="app.shareBranch(event)">ğŸŒ³</a>
          </div>
          <div class="content-meta"><span id="nodeMeta"></span></div>

          <div class="tags-container" id="tagsContainer">
            <!-- Tags gÃ©nÃ©rÃ©s dynamiquement -->
            <div style="position: relative;">
              <input type="text" class="tag-input" id="tagInput"
                     data-i18n-placeholder="placeholders.tagInput" placeholder="+ tag"
                     onkeydown="app.handleTagInput(event)"
                     oninput="app.handleTagAutocomplete(event)"
                     onfocus="app.showTagAutocomplete()"
                     onblur="app.hideTagAutocomplete()">
              <div class="tag-autocomplete" id="tagAutocomplete" style="display: none;"></div>
            </div>
          </div>
        </div>

        <div class="content-body">
          <textarea class="content-editor" id="nodeContent"
                    data-i18n-placeholder="placeholders.nodeContent" placeholder="Ã‰cris ton contenu ici... (Utilise [[Nom du nÅ“ud]] pour crÃ©er des liens)"
                    onchange="app.saveCurrentNode()"
                    oninput="app.autoResizeTextarea(event.target)"></textarea>

          <div class="content-preview" id="contentPreview" style="display: none;"></div>

          <!-- Attachments Section -->
          <div class="attachments-section" id="attachmentsSection" style="display: none;">
            <div class="attachments-header"><span data-i18n="labels.attachments">ğŸ“ Fichiers attachÃ©s</span> (<span id="attachmentsCount">0</span>)</div>
            <div class="attachments-list" id="attachmentsList"></div>
            <button class="btn btn-secondary btn-small" id="addAttachmentBtn" data-i18n="actions.addAttachment" onclick="app.triggerFileUpload()">
              ğŸ“ Ajouter un fichier
            </button>
          </div>

          <div class="children-section" id="childrenSection" style="display: none;">
            <div class="children-header"><span data-i18n="labels.children">ğŸ“‚ NÅ“uds enfants</span> (<span id="childrenCount">0</span>)</div>
            <div class="children-grid" id="childrenGrid"></div>
          </div>
        </div>

        <div class="content-actions">
          <button class="btn btn-secondary btn-small" id="toggleViewMode" data-i18n="actions.toggleView" onclick="app.toggleViewMode()">ğŸ‘ï¸ Afficher</button>
          <button class="btn btn-secondary btn-small" data-i18n="actions.addChild" onclick="app.createChildNode()">â• Ajouter un enfant</button>
          <button class="btn btn-secondary btn-small" data-i18n="actions.openActions" onclick="app.openActionModal()">âš™ï¸ Actions...</button>
          <div style="margin-left: auto; display: flex; gap: 8px;">
            <button class="btn btn-secondary btn-small" data-i18n-title="tooltips.exportBranch" onclick="app.exportBranch()" title="Exporter ce nÅ“ud et ses descendants">â¬‡ï¸ Export branche</button>
            <input type="file" id="importBranchFile" accept=".json,.zip" onchange="app.importBranch(event)" style="display: none;">
            <label for="importBranchFile" class="btn btn-secondary btn-small" data-i18n-title="tooltips.importBranch" style="margin: 0; cursor: pointer;" title="Importer une branche comme enfants">â¬†ï¸ Import branche</label>
          </div>
        </div>

        <!-- Hidden file input for attachments -->
        <input type="file" id="attachmentFileInput" style="display: none;" onchange="app.handleAttachmentUpload(event)">
      </div>
    </div>

    <div class="right-panel" id="rightPanel">
      <div class="panel-header">
        <button class="right-panel-toggle" onclick="app.toggleRightPanel()">âœ•</button>
        <div class="panel-title">Informations</div>
      </div>
      <div class="panel-body" id="panelBody"></div>
    </div>
  </div>

  <div class="toast" id="toast">
    <div class="toast-icon" id="toastIcon">âœ…</div>
    <div class="toast-message" id="toastMessage">Message</div>
  </div>

  <div class="search-modal" id="searchModal">
    <div class="search-container">
      <div class="search-input-wrapper">
        <div class="search-icon">ğŸ”</div>
        <input type="text" class="search-input" id="searchInput"
               data-i18n-placeholder="placeholders.search" placeholder="Rechercher dans tous les nÅ“uds..." autocomplete="off">
        <span class="search-hint">Esc</span>
      </div>
      <div class="search-results" id="searchResults">
        <div class="search-empty">
          <div class="search-empty-icon">ğŸ’­</div>
          <div data-i18n="modals.search.emptyHint">Tape pour rechercher dans tes nÅ“uds</div>
        </div>
      </div>
      <div class="search-footer">
        <div class="search-footer-item" data-i18n="modals.search.navigate"><kbd>â†‘</kbd><kbd>â†“</kbd> Naviguer</div>
        <div class="search-footer-item" data-i18n="modals.search.open"><kbd>EntrÃ©e</kbd> Ouvrir</div>
        <div class="search-footer-item" data-i18n="modals.search.close"><kbd>Esc</kbd> Fermer</div>
      </div>
    </div>
  </div>

  <!-- Modal Symlink -->
  <div class="modal-overlay" id="symlinkModal">
    <div class="modal">
      <h2 data-i18n="modals.symlink.title">ğŸ”— CrÃ©er un lien symbolique</h2>
      <div class="modal-body">
        <p style="color: var(--text-secondary); margin-bottom: 16px;" data-i18n="modals.symlink.subtitle">
          Choisis oÃ¹ afficher ce nÅ“ud comme lien symbolique :
        </p>
        <div class="node-selector" id="nodeSelector"></div>
      </div>
      <div class="modal-actions">
        <button class="btn btn-secondary btn-small" data-i18n="modals.symlink.cancel" onclick="app.closeSymlinkModal()">Annuler</button>
        <button class="btn btn-small" data-i18n="modals.symlink.confirm" onclick="app.confirmSymlink()">ğŸ”— CrÃ©er le lien</button>
      </div>
    </div>
  </div>

  <!-- Modal Actions (DÃ©placer/Lien/Dupliquer) -->
  <div class="modal-overlay" id="actionModal">
    <div class="modal">
      <h2 data-i18n="modals.actions.title">âš™ï¸ Actions sur le nÅ“ud</h2>
      <div class="modal-body">
        <p style="color: var(--text-secondary); margin-bottom: 16px;" data-i18n="modals.actions.subtitle">
          Que veux-tu faire avec ce nÅ“ud ?
        </p>

        <!-- Choix de l'action -->
        <div style="display: flex; gap: 8px; margin-bottom: 20px;">
          <button class="btn btn-secondary btn-small" id="actionMove" data-i18n="modals.actions.move" onclick="app.selectAction('move')" style="flex: 1; border-radius: 8px;">
            â†—ï¸ DÃ©placer
          </button>
          <button class="btn btn-secondary btn-small" id="actionLink" data-i18n="modals.actions.link" onclick="app.selectAction('link')" style="flex: 1; border-radius: 8px;">
            ğŸ”— Lien
          </button>
          <button class="btn btn-secondary btn-small" id="actionDuplicate" data-i18n="modals.actions.duplicate" onclick="app.selectAction('duplicate')" style="flex: 1; border-radius: 8px;">
            ğŸ“‹ Dupliquer
          </button>
          <button class="btn btn-secondary btn-small" id="actionDelete" data-i18n="modals.actions.delete" onclick="app.selectAction('delete')" style="flex: 1; border-radius: 8px;">
            ğŸ—‘ï¸ Supprimer
          </button>
        </div>

        <div id="actionDescription" style="color: var(--text-secondary); font-size: 13px; margin-bottom: 16px; min-height: 40px; display: none;">
        </div>

        <div class="node-selector" id="actionNodeSelector" style="display: none;"></div>
      </div>
      <div class="modal-actions">
        <button class="btn btn-secondary btn-small" data-i18n="modals.actions.cancel" onclick="app.closeActionModal()">Annuler</button>
        <button class="btn btn-small" id="confirmActionBtn" data-i18n="modals.actions.confirm" onclick="app.confirmAction()" disabled>âœ“ Confirmer</button>
      </div>
    </div>
  </div>

  <!-- Modal Aide Markdown -->
  <div class="modal-overlay" id="markdownHelpModal">
    <div class="modal" style="max-width: 800px; max-height: 90vh; overflow-y: auto;">
      <h2>ğŸ“˜ <span data-i18n="modals.markdown.title">Guide Markdown</span></h2>
      <div class="modal-body" id="markdownHelpContent">
        <!-- Content will be dynamically generated by modals.js with i18n -->
      </div>
      <div class="modal-actions">
        <button class="btn btn-primary btn-small" data-i18n="actions.close" onclick="app.closeMarkdownHelp()">Fermer</button>
      </div>
    </div>
  </div>

  <!-- Enregistrement du Service Worker pour PWA -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js')
          .then((registration) => {
            console.log('[PWA] Service Worker enregistrÃ©:', registration.scope);
          })
          .catch((error) => {
            console.log('[PWA] Ã‰chec enregistrement Service Worker:', error);
          });
      });
    }
  </script>

  <script type="module" src="src/js/app.js"></script>
</body>
</html>
