<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#0a0a0a">
  <meta name="description" content="DeepMemo - SystÃ¨me de gestion de connaissances basÃ© sur des nÅ“uds rÃ©cursifs, interconnectÃ©s et actifs">
  <title>DeepMemo V0.8</title>
  <link rel="icon" type="image/svg+xml" href="favicon.svg">
  <link rel="manifest" href="manifest.json">
  <link rel="stylesheet" href="src/css/style.css">
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
  <button class="right-panel-toggle-external" onclick="app.toggleRightPanel()">â„¹ï¸</button>

  <div class="app-container">
    <div class="sidebar">
      <div class="sidebar-header">
        <h1>ğŸŒŸ DeepMemo</h1>
        <div class="tagline">Ton second cerveau</div>
        <div class="node-counter" id="nodeCounter">0 nÅ“uds</div>
      </div>

      <div class="sidebar-actions">
        <button class="btn" onclick="app.createRootNode()">â• Nouveau nÅ“ud</button>
        <div class="import-export-zone">
          <input type="file" id="importFile" accept=".json" onchange="app.importData(event)">
          <label for="importFile" class="btn-import">ğŸ“‚ Importer</label>
          <button class="btn-import" onclick="app.exportData()">ğŸ’¾ Exporter</button>
        </div>
      </div>

      <div class="tree-container" id="treeContainer"></div>
      <div class="sidebar-resizer" id="sidebarResizer"></div>
    </div>

    <div class="main-content">
      <div id="emptyState" class="empty-state">
        <div class="empty-state-icon">ğŸ§©</div>
        <h2>Bienvenue dans DeepMemo</h2>
        <p>CrÃ©e ton premier nÅ“ud pour commencer</p>
      </div>

      <div id="editorContainer" style="display: none; flex: 1; display: flex; flex-direction: column;">
        <div class="breadcrumb" id="breadcrumb"></div>

        <div class="content-header">
          <div style="display: flex; align-items: center; gap: 8px;">
            <input type="text" class="content-title-input" id="nodeTitle"
                   placeholder="Titre du nÅ“ud" onchange="app.saveCurrentNode()">
            <a href="#" id="shareLink" title="Partager ce nÅ“ud (clic pour copier, clic droit pour copier le lien)"
               style="font-size: 20px; text-decoration: none; cursor: pointer; opacity: 0.6; transition: opacity 0.2s;"
               onmouseover="this.style.opacity='1'"
               onmouseout="this.style.opacity='0.6'"
               onclick="app.shareNode(event)">ğŸ”—</a>
            <a href="#" id="shareBranchLink" title="Partager comme branche isolÃ©e (clic pour copier, clic droit pour copier le lien)"
               style="font-size: 20px; text-decoration: none; cursor: pointer; opacity: 0.6; transition: opacity 0.2s;"
               onmouseover="this.style.opacity='1'"
               onmouseout="this.style.opacity='0.6'"
               onclick="app.shareBranch(event)">ğŸŒ³</a>
          </div>
          <div class="content-meta"><span id="nodeMeta"></span></div>

          <div class="tags-container" id="tagsContainer">
            <!-- Tags gÃ©nÃ©rÃ©s dynamiquement -->
            <div style="position: relative;">
              <input type="text" class="tag-input" id="tagInput"
                     placeholder="+ tag"
                     onkeydown="app.handleTagInput(event)"
                     oninput="app.handleTagAutocomplete(event)"
                     onfocus="app.showTagAutocomplete()"
                     onblur="app.hideTagAutocomplete()">
              <div class="tag-autocomplete" id="tagAutocomplete" style="display: none;"></div>
            </div>
          </div>
        </div>

        <div class="content-body">
          <textarea class="content-editor" id="nodeContent"
                    placeholder="Ã‰cris ton contenu ici... (Utilise [[Nom du nÅ“ud]] pour crÃ©er des liens)"
                    onchange="app.saveCurrentNode()"
                    oninput="app.autoResizeTextarea(event.target)"></textarea>

          <div class="content-preview" id="contentPreview" style="display: none;"></div>

          <!-- Attachments Section -->
          <div class="attachments-section" id="attachmentsSection" style="display: none;">
            <div class="attachments-header">ğŸ“ Fichiers attachÃ©s (<span id="attachmentsCount">0</span>)</div>
            <div class="attachments-list" id="attachmentsList"></div>
            <button class="btn btn-secondary btn-small" id="addAttachmentBtn" onclick="app.triggerFileUpload()">
              ğŸ“ Ajouter un fichier
            </button>
          </div>

          <div class="children-section" id="childrenSection" style="display: none;">
            <div class="children-header">ğŸ“‚ NÅ“uds enfants (<span id="childrenCount">0</span>)</div>
            <div class="children-grid" id="childrenGrid"></div>
          </div>
        </div>

        <div class="content-actions">
          <button class="btn btn-secondary btn-small" id="toggleViewMode" onclick="app.toggleViewMode()">ğŸ‘ï¸ Afficher</button>
          <button class="btn btn-secondary btn-small" onclick="app.createChildNode()">â• Ajouter un enfant</button>
          <button class="btn btn-secondary btn-small" onclick="app.openActionModal()">âš™ï¸ Actions...</button>
          <div style="margin-left: auto; display: flex; gap: 8px;">
            <button class="btn btn-secondary btn-small" onclick="app.exportBranch()" title="Exporter ce nÅ“ud et ses descendants">â¬‡ï¸ Export branche</button>
            <input type="file" id="importBranchFile" accept=".json" onchange="app.importBranch(event)" style="display: none;">
            <label for="importBranchFile" class="btn btn-secondary btn-small" style="margin: 0; cursor: pointer;" title="Importer une branche comme enfants">â¬†ï¸ Import branche</label>
          </div>
        </div>

        <!-- Hidden file input for attachments -->
        <input type="file" id="attachmentFileInput" style="display: none;" onchange="app.handleAttachmentUpload(event)">
      </div>
    </div>

    <div class="right-panel" id="rightPanel">
      <div class="panel-header">
        <button class="right-panel-toggle" onclick="app.toggleRightPanel()">âœ•</button>
        <div class="panel-title">Informations</div>
      </div>
      <div class="panel-body" id="panelBody"></div>
    </div>
  </div>

  <div class="toast" id="toast">
    <div class="toast-icon" id="toastIcon">âœ…</div>
    <div class="toast-message" id="toastMessage">Message</div>
  </div>

  <div class="search-modal" id="searchModal">
    <div class="search-container">
      <div class="search-input-wrapper">
        <div class="search-icon">ğŸ”</div>
        <input type="text" class="search-input" id="searchInput"
               placeholder="Rechercher dans tous les nÅ“uds..." autocomplete="off">
        <span class="search-hint">Esc</span>
      </div>
      <div class="search-results" id="searchResults">
        <div class="search-empty">
          <div class="search-empty-icon">ğŸ’­</div>
          <div>Tape pour rechercher dans tes nÅ“uds</div>
        </div>
      </div>
      <div class="search-footer">
        <div class="search-footer-item"><kbd>â†‘</kbd><kbd>â†“</kbd> Naviguer</div>
        <div class="search-footer-item"><kbd>EntrÃ©e</kbd> Ouvrir</div>
        <div class="search-footer-item"><kbd>Esc</kbd> Fermer</div>
      </div>
    </div>
  </div>

  <!-- Modal Symlink -->
  <div class="modal-overlay" id="symlinkModal">
    <div class="modal">
      <h2>ğŸ”— CrÃ©er un lien symbolique</h2>
      <div class="modal-body">
        <p style="color: var(--text-secondary); margin-bottom: 16px;">
          Choisis oÃ¹ afficher ce nÅ“ud comme lien symbolique :
        </p>
        <div class="node-selector" id="nodeSelector"></div>
      </div>
      <div class="modal-actions">
        <button class="btn btn-secondary btn-small" onclick="app.closeSymlinkModal()">Annuler</button>
        <button class="btn btn-small" onclick="app.confirmSymlink()">ğŸ”— CrÃ©er le lien</button>
      </div>
    </div>
  </div>

  <!-- Modal Actions (DÃ©placer/Lien/Dupliquer) -->
  <div class="modal-overlay" id="actionModal">
    <div class="modal">
      <h2>âš™ï¸ Actions sur le nÅ“ud</h2>
      <div class="modal-body">
        <p style="color: var(--text-secondary); margin-bottom: 16px;">
          Que veux-tu faire avec ce nÅ“ud ?
        </p>

        <!-- Choix de l'action -->
        <div style="display: flex; gap: 8px; margin-bottom: 20px;">
          <button class="btn btn-secondary btn-small" id="actionMove" onclick="app.selectAction('move')" style="flex: 1; border-radius: 8px;">
            â†—ï¸ DÃ©placer
          </button>
          <button class="btn btn-secondary btn-small" id="actionLink" onclick="app.selectAction('link')" style="flex: 1; border-radius: 8px;">
            ğŸ”— Lien
          </button>
          <button class="btn btn-secondary btn-small" id="actionDuplicate" onclick="app.selectAction('duplicate')" style="flex: 1; border-radius: 8px;">
            ğŸ“‹ Dupliquer
          </button>
          <button class="btn btn-secondary btn-small" id="actionDelete" onclick="app.selectAction('delete')" style="flex: 1; border-radius: 8px;">
            ğŸ—‘ï¸ Supprimer
          </button>
        </div>

        <div id="actionDescription" style="color: var(--text-secondary); font-size: 13px; margin-bottom: 16px; min-height: 40px; display: none;">
        </div>

        <div class="node-selector" id="actionNodeSelector" style="display: none;"></div>
      </div>
      <div class="modal-actions">
        <button class="btn btn-secondary btn-small" onclick="app.closeActionModal()">Annuler</button>
        <button class="btn btn-small" id="confirmActionBtn" onclick="app.confirmAction()" disabled>âœ“ Confirmer</button>
      </div>
    </div>
  </div>

  <!-- Enregistrement du Service Worker pour PWA -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js')
          .then((registration) => {
            console.log('[PWA] Service Worker enregistrÃ©:', registration.scope);
          })
          .catch((error) => {
            console.log('[PWA] Ã‰chec enregistrement Service Worker:', error);
          });
      });
    }
  </script>

  <script type="module" src="src/js/app.js"></script>
</body>
</html>
